<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Day {{day_number}} - HomeBound</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#ec7f13",
                    "background-dark": "#221910",
                },
                fontFamily: {
                    "display": ["Space Grotesk", "sans-serif"]
                }
            }
        }
    }
</script>
<style>
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    .story-image { min-height: 200px; background-size: cover; background-position: center; }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative mx-auto flex h-screen max-h-screen w-full max-w-md flex-col overflow-hidden bg-[#221a11]">

    <!-- Header -->
    <header class="flex shrink-0 items-center border-b border-primary/30 bg-[#221a11] p-4 pb-2">
        <span class="material-symbols-outlined text-primary text-3xl">signal_cellular_alt</span>
        <h1 class="flex-1 text-center text-lg font-bold uppercase tracking-widest text-primary">Transmission Day {{day_number}}</h1>
        <a href="index.html" class="size-8 flex items-center justify-center">
            <span class="material-symbols-outlined text-primary text-2xl">home</span>
        </a>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto px-4 pt-4" id="game-content">

        <!-- Turn 1 Content -->
        <div id="turn-1" class="turn-content">
            <div class="mb-3">
                <h2 class="text-xl font-bold text-primary mb-2">üìç {{planet_name}}</h2>
            </div>

            <!-- Image -->
            <div class="aspect-video w-full mb-4">
                <div class="story-image h-full w-full rounded border border-primary/20 bg-cover bg-center bg-no-repeat"
                     style="background-image: url('{{turn1_image_url}}');">
                </div>
            </div>

            <!-- Story Text -->
            <div class="space-y-3 mb-4">
                <p class="font-normal leading-normal text-white">{{turn1_para1}}</p>
                <p class="font-normal leading-normal text-white">{{turn1_para2}}</p>
                <p class="font-normal leading-normal text-white">{{turn1_para3}}</p>
            </div>

            <!-- Audio Player -->
            <div class="py-3 mb-4" id="audio-player-1" style="display: none;">
                <div class="flex flex-col gap-3 rounded-lg border border-primary/20 bg-black/20 p-4">
                    <div class="flex items-center gap-4">
                        <button class="flex size-12 shrink-0 items-center justify-center rounded-full bg-primary text-background-dark transition-transform active:scale-95" onclick="toggleAudio(1)">
                            <span class="material-symbols-outlined text-3xl" id="play-icon-1">play_arrow</span>
                        </button>
                        <div class="flex-1">
                            <p class="text-base font-bold leading-tight text-white">AUDIO LOG</p>
                            <p class="text-sm font-normal leading-normal text-primary/70">Mission Recording</p>
                        </div>
                    </div>
                    <audio id="audio-1" src="{{turn1_audio_url}}"></audio>
                </div>
            </div>

            <!-- Choices -->
            <div class="space-y-3 mb-6">
                <button onclick="makeChoice(1, 'a')"
                        class="w-full rounded-lg border border-primary/30 bg-black/30 p-4 text-left text-white hover:bg-primary/20 hover:border-primary transition-all">
                    <span class="font-bold text-primary">Choice A:</span> {{turn1_choice_a}}
                </button>
                <button onclick="makeChoice(1, 'b')"
                        class="w-full rounded-lg border border-primary/30 bg-black/30 p-4 text-left text-white hover:bg-primary/20 hover:border-primary transition-all">
                    <span class="font-bold text-primary">Choice B:</span> {{turn1_choice_b}}
                </button>
            </div>
        </div>

        <!-- Turn 2 Content (Hidden Initially) -->
        <div id="turn-2" class="turn-content hidden">
            <!-- Image -->
            <div class="aspect-video w-full mb-4">
                <div class="story-image h-full w-full rounded border border-primary/20 bg-cover bg-center bg-no-repeat"
                     style="background-image: url('{{turn2_image_url}}');">
                </div>
            </div>

            <!-- Story Text -->
            <div class="space-y-3 mb-4">
                <p class="font-normal leading-normal text-white">{{turn2_para1}}</p>
                <p class="font-normal leading-normal text-white">{{turn2_para2}}</p>
                <p class="font-normal leading-normal text-white">{{turn2_para3}}</p>
            </div>

            <!-- Audio Player -->
            <div class="py-3 mb-4" id="audio-player-2" style="display: none;">
                <div class="flex flex-col gap-3 rounded-lg border border-primary/20 bg-black/20 p-4">
                    <div class="flex items-center gap-4">
                        <button class="flex size-12 shrink-0 items-center justify-center rounded-full bg-primary text-background-dark transition-transform active:scale-95" onclick="toggleAudio(2)">
                            <span class="material-symbols-outlined text-3xl" id="play-icon-2">play_arrow</span>
                        </button>
                        <div class="flex-1">
                            <p class="text-base font-bold leading-tight text-white">AUDIO LOG</p>
                            <p class="text-sm font-normal leading-normal text-primary/70">Mission Recording</p>
                        </div>
                    </div>
                    <audio id="audio-2" src="{{turn2_audio_url}}"></audio>
                </div>
            </div>

            <!-- Choices -->
            <div class="space-y-3 mb-6">
                <button onclick="makeChoice(2, 'a')"
                        class="w-full rounded-lg border border-primary/30 bg-black/30 p-4 text-left text-white hover:bg-primary/20 hover:border-primary transition-all">
                    <span class="font-bold text-primary">Choice A:</span> {{turn2_choice_a}}
                </button>
                <button onclick="makeChoice(2, 'b')"
                        class="w-full rounded-lg border border-primary/30 bg-black/30 p-4 text-left text-white hover:bg-primary/20 hover:border-primary transition-all">
                    <span class="font-bold text-primary">Choice B:</span> {{turn2_choice_b}}
                </button>
            </div>
        </div>

        <!-- Turn 3 Content (Hidden Initially) -->
        <div id="turn-3" class="turn-content hidden">
            <!-- Image -->
            <div class="aspect-video w-full mb-4">
                <div class="story-image h-full w-full rounded border border-primary/20 bg-cover bg-center bg-no-repeat"
                     style="background-image: url('{{turn3_image_url}}');">
                </div>
            </div>

            <!-- Story Text -->
            <div class="space-y-3 mb-4">
                <p class="font-normal leading-normal text-white">{{turn3_para1}}</p>
                <p class="font-normal leading-normal text-white">{{turn3_para2}}</p>
                <p class="font-normal leading-normal text-white">{{turn3_para3}}</p>
            </div>

            <!-- Audio Player -->
            <div class="py-3 mb-4" id="audio-player-3" style="display: none;">
                <div class="flex flex-col gap-3 rounded-lg border border-primary/20 bg-black/20 p-4">
                    <div class="flex items-center gap-4">
                        <button class="flex size-12 shrink-0 items-center justify-center rounded-full bg-primary text-background-dark transition-transform active:scale-95" onclick="toggleAudio(3)">
                            <span class="material-symbols-outlined text-3xl" id="play-icon-3">play_arrow</span>
                        </button>
                        <div class="flex-1">
                            <p class="text-base font-bold leading-tight text-white">AUDIO LOG</p>
                            <p class="text-sm font-normal leading-normal text-primary/70">Mission Recording</p>
                        </div>
                    </div>
                    <audio id="audio-3" src="{{turn3_audio_url}}"></audio>
                </div>
            </div>

            <!-- Choices -->
            <div class="space-y-3 mb-6">
                <button onclick="makeChoice(3, 'a')"
                        class="w-full rounded-lg border border-primary/30 bg-black/30 p-4 text-left text-white hover:bg-primary/20 hover:border-primary transition-all">
                    <span class="font-bold text-primary">Choice A:</span> {{turn3_choice_a}}
                </button>
                <button onclick="makeChoice(3, 'b')"
                        class="w-full rounded-lg border border-primary/30 bg-black/30 p-4 text-left text-white hover:bg-primary/20 hover:border-primary transition-all">
                    <span class="font-bold text-primary">Choice B:</span> {{turn3_choice_b}}
                </button>
            </div>
        </div>

        <!-- Death Screen (Hidden) -->
        <div id="death-screen" class="hidden">
            <div class="rounded-lg border border-red-500/30 bg-red-900/20 p-6 mb-6">
                <h2 class="text-2xl font-bold text-red-500 mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-4xl">dangerous</span>
                    Mission Failed
                </h2>
                <p class="text-white leading-normal mb-4" id="death-message"></p>
                <button onclick="location.reload()"
                        class="w-full rounded-lg bg-primary py-3 font-bold uppercase text-background-dark">
                    Try Again
                </button>
            </div>
        </div>

        <!-- Success Screen (Hidden) -->
        <div id="success-screen" class="hidden">
            <div class="rounded-lg border border-green-500/30 bg-green-900/20 p-6 mb-6">
                <h2 class="text-2xl font-bold text-green-500 mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-4xl">check_circle</span>
                    Mission Success!
                </h2>
                <p class="text-white leading-normal mb-4">{{home_trip_desc}}</p>
                <a href="index.html"
                   class="block w-full rounded-lg bg-primary py-3 font-bold uppercase text-background-dark text-center">
                    Return to Base
                </a>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="flex shrink-0 gap-2 border-t border-primary/30 bg-[#332619] px-4 pb-3 pt-2">
        <div class="flex flex-1 flex-col items-center justify-end gap-1 text-primary">
            <span class="material-symbols-outlined text-2xl">satellite_alt</span>
            <p class="text-xs font-medium leading-normal tracking-[0.015em] text-primary">DAY: {{day_number}}</p>
        </div>
        <div class="flex flex-1 flex-col items-center justify-end gap-1 text-primary/70">
            <span class="material-symbols-outlined text-2xl">rocket_launch</span>
            <p class="text-xs font-medium leading-normal tracking-[0.015em] text-primary/70" id="turn-indicator">TURN: 1/3</p>
        </div>
    </footer>
</div>

<script>
    // Hidden data for game logic
    const deathMessages = {
        1: "{{turn1_death_desc}}",
        2: "{{turn2_death_desc}}",
        3: "{{turn3_death_desc}}"
    };

    // Correct choices (randomized on page load)
    const correctChoices = {
        1: Math.random() > 0.5 ? 'a' : 'b',
        2: Math.random() > 0.5 ? 'a' : 'b',
        3: Math.random() > 0.5 ? 'a' : 'b'
    };

    let currentTurn = 1;

    // Show audio players if audio URLs exist
    window.addEventListener('DOMContentLoaded', function() {
        if ("{{turn1_audio_url}}".trim()) document.getElementById('audio-player-1').style.display = 'block';
        if ("{{turn2_audio_url}}".trim()) document.getElementById('audio-player-2').style.display = 'block';
        if ("{{turn3_audio_url}}".trim()) document.getElementById('audio-player-3').style.display = 'block';
    });

    function makeChoice(turn, choice) {
        if (turn !== currentTurn) return;

        // Check if correct choice
        if (choice === correctChoices[turn]) {
            // Correct choice - advance to next turn
            if (turn < 3) {
                document.getElementById('turn-' + turn).classList.add('hidden');
                currentTurn++;
                document.getElementById('turn-' + currentTurn).classList.remove('hidden');
                document.getElementById('turn-indicator').textContent = 'TURN: ' + currentTurn + '/3';

                // Scroll to top
                document.getElementById('game-content').scrollTop = 0;
            } else {
                // Final turn success
                document.getElementById('turn-3').classList.add('hidden');
                document.getElementById('success-screen').classList.remove('hidden');
                document.getElementById('turn-indicator').textContent = 'SUCCESS!';
            }
        } else {
            // Wrong choice - show death
            document.getElementById('turn-' + turn).classList.add('hidden');
            document.getElementById('death-message').textContent = deathMessages[turn];
            document.getElementById('death-screen').classList.remove('hidden');
            document.getElementById('turn-indicator').textContent = 'FAILED';
        }
    }

    function toggleAudio(turn) {
        const audio = document.getElementById('audio-' + turn);
        const icon = document.getElementById('play-icon-' + turn);

        if (audio.paused) {
            // Pause all other audio
            document.querySelectorAll('audio').forEach(a => {
                if (a !== audio) a.pause();
            });
            document.querySelectorAll('[id^="play-icon-"]').forEach(i => {
                i.textContent = 'play_arrow';
            });

            audio.play();
            icon.textContent = 'pause';
        } else {
            audio.pause();
            icon.textContent = 'play_arrow';
        }
    }

    // Reset icon when audio ends
    document.querySelectorAll('audio').forEach((audio, index) => {
        audio.addEventListener('ended', function() {
            document.getElementById('play-icon-' + (index + 1)).textContent = 'play_arrow';
        });
    });
</script>
</body>
</html>
